# BerthCare Architecture Diagrams

**Version:** 2.0.0  
**Last Updated:** October 7, 2025

## System Overview

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              BerthCare System                                    │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │                         Client Applications                             │     │
│  │                                                                          │     │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │     │
│  │  │  Mobile App  │  │   Family     │  │    Admin     │                 │     │
│  │  │  (Nurses)    │  │   Portal     │  │  Dashboard   │                 │     │
│  │  │              │  │   (Web)      │  │   (Web)      │                 │     │
│  │  │ React Native │  │   React      │  │   React      │                 │     │
│  │  │ WatermelonDB │  │              │  │              │                 │     │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                 │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│                                    ↓ HTTPS/TLS 1.2+                             │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │                         AWS CloudFront CDN                              │     │
│  │  - Edge caching (photos, static assets)                                │     │
│  │  - SSL/TLS termination                                                  │     │
│  │  - DDoS protection                                                      │     │
│  │  - Compression (Gzip, Brotli)                                           │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │                    Application Load Balancer (ALB)                      │     │
│  │  - Health checks                                                        │     │
│  │  - SSL termination                                                      │     │
│  │  - Request routing                                                      │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │                         Backend API Layer                               │     │
│  │                                                                          │     │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │     │
│  │  │  Node.js/Express API (ECS Fargate)                               │  │     │
│  │  │  - REST endpoints                                                 │  │     │
│  │  │  - Socket.io (real-time)                                          │  │     │
│  │  │  - JWT authentication                                             │  │     │
│  │  │  - Rate limiting                                                  │  │     │
│  │  │  - Request validation                                             │  │     │
│  │  └──────────────────────────────────────────────────────────────────┘  │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │                          Data Layer                                     │     │
│  │                                                                          │     │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │     │
│  │  │  PostgreSQL  │  │    Redis     │  │   S3 Buckets │                 │     │
│  │  │     RDS      │  │ ElastiCache  │  │              │                 │     │
│  │  │              │  │              │  │  - Photos    │                 │     │
│  │  │  Multi-AZ    │  │  Primary +   │  │  - Documents │                 │     │
│  │  │  Encrypted   │  │  Replica     │  │              │                 │     │
│  │  │              │  │  Encrypted   │  │  Encrypted   │                 │     │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                 │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │                      External Services                                  │     │
│  │                                                                          │     │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │     │
│  │  │   Twilio     │  │    Sentry    │  │  CloudWatch  │                 │     │
│  │  │              │  │              │  │              │                 │     │
│  │  │  Voice/SMS   │  │    Error     │  │  Monitoring  │                 │     │
│  │  │              │  │   Tracking   │  │   & Logs     │                 │     │
│  │  └──────────────┘  └──────────────┘  └──────────────┘                 │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## AWS Network Architecture (Staging)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│  AWS Region: ca-central-1 (Canada Central)                                       │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────────┐ │
│  │  VPC: berthcare-staging-vpc (10.0.0.0/16)                                  │ │
│  │                                                                              │ │
│  │  ┌────────────────────────────────────────────────────────────────────┐    │ │
│  │  │  Availability Zone: ca-central-1a                                   │    │ │
│  │  │                                                                      │    │ │
│  │  │  ┌──────────────────────────────────────────────────────────────┐  │    │ │
│  │  │  │  Public Subnet (10.0.1.0/24)                                 │  │    │ │
│  │  │  │  ┌────────────────┐                                           │  │    │ │
│  │  │  │  │  NAT Gateway   │                                           │  │    │ │
│  │  │  │  │  (Elastic IP)  │                                           │  │    │ │
│  │  │  │  └────────────────┘                                           │  │    │ │
│  │  │  └──────────────────────────────────────────────────────────────┘  │    │ │
│  │  │                              ↓                                      │    │ │
│  │  │  ┌──────────────────────────────────────────────────────────────┐  │    │ │
│  │  │  │  Private Subnet (10.0.11.0/24)                               │  │    │ │
│  │  │  │  ┌────────────────────────────────────────────────────────┐  │  │    │ │
│  │  │  │  │  Backend API (ECS Fargate)                             │  │  │    │ │
│  │  │  │  │  - Auto-scaling: 1-3 tasks                             │  │  │    │ │
│  │  │  │  │  - Security Group: backend-sg                          │  │  │    │ │
│  │  │  │  └────────────────────────────────────────────────────────┘  │  │    │ │
│  │  │  └──────────────────────────────────────────────────────────────┘  │    │ │
│  │  │                              ↓                                      │    │ │
│  │  │  ┌──────────────────────────────────────────────────────────────┐  │    │ │
│  │  │  │  Database Subnet (10.0.21.0/24)                              │  │    │ │
│  │  │  │  ┌────────────────┐  ┌────────────────┐                      │  │    │ │
│  │  │  │  │  RDS Primary   │  │  Redis Primary │                      │  │    │ │
│  │  │  │  │  PostgreSQL    │  │  ElastiCache   │                      │  │    │ │
│  │  │  │  └────────────────┘  └────────────────┘                      │  │    │ │
│  │  │  └──────────────────────────────────────────────────────────────┘  │    │ │
│  │  └────────────────────────────────────────────────────────────────────┘    │ │
│  │                                                                              │ │
│  │  ┌────────────────────────────────────────────────────────────────────┐    │ │
│  │  │  Availability Zone: ca-central-1b                                   │    │ │
│  │  │                                                                      │    │ │
│  │  │  ┌──────────────────────────────────────────────────────────────┐  │    │ │
│  │  │  │  Public Subnet (10.0.2.0/24)                                 │  │    │ │
│  │  │  │  ┌────────────────┐                                           │  │    │ │
│  │  │  │  │  NAT Gateway   │                                           │  │    │ │
│  │  │  │  │  (Elastic IP)  │                                           │  │    │ │
│  │  │  │  └────────────────┘                                           │  │    │ │
│  │  │  └──────────────────────────────────────────────────────────────┘  │    │ │
│  │  │                              ↓                                      │    │ │
│  │  │  ┌──────────────────────────────────────────────────────────────┐  │    │ │
│  │  │  │  Private Subnet (10.0.12.0/24)                               │  │    │ │
│  │  │  │  ┌────────────────────────────────────────────────────────┐  │  │    │ │
│  │  │  │  │  Backend API (ECS Fargate)                             │  │  │    │ │
│  │  │  │  │  - Auto-scaling: 1-3 tasks                             │  │  │    │ │
│  │  │  │  │  - Security Group: backend-sg                          │  │  │    │ │
│  │  │  │  └────────────────────────────────────────────────────────┘  │  │    │ │
│  │  │  └──────────────────────────────────────────────────────────────┘  │    │ │
│  │  │                              ↓                                      │    │ │
│  │  │  ┌──────────────────────────────────────────────────────────────┐  │    │ │
│  │  │  │  Database Subnet (10.0.22.0/24)                              │  │    │ │
│  │  │  │  ┌────────────────┐  ┌────────────────┐                      │  │    │ │
│  │  │  │  │  RDS Standby   │  │  Redis Replica │                      │  │    │ │
│  │  │  │  │  (Multi-AZ)    │  │  (Failover)    │                      │  │    │ │
│  │  │  │  └────────────────┘  └────────────────┘                      │  │    │ │
│  │  │  └──────────────────────────────────────────────────────────────┘  │    │ │
│  │  └────────────────────────────────────────────────────────────────────┘    │ │
│  └────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Data Flow: Mobile App Sync

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│  Mobile Device (Offline-First)                                                   │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  1. Nurse documents visit                                              │     │
│  │     - Vitals, tasks, notes                                              │     │
│  │     - Photos, signatures                                                │     │
│  │     - Saved to local SQLite                                             │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  2. WatermelonDB marks records as changed                              │     │
│  │     - _status: 'created' | 'updated' | 'deleted'                       │     │
│  │     - _changed: timestamp                                               │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  3. Background sync detects connectivity                               │     │
│  │     - WiFi or cellular data available                                   │     │
│  │     - Sync queue not empty                                              │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    ↓
                                    ↓ HTTPS POST /api/v1/sync
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────────┐
│  Backend API                                                                     │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  4. Validate sync request                                              │     │
│  │     - JWT authentication                                                │     │
│  │     - User permissions                                                  │     │
│  │     - Data validation                                                   │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  5. Check for conflicts                                                │     │
│  │     - Compare timestamps                                                │     │
│  │     - Last-write-wins strategy                                          │     │
│  │     - Log conflicts for review                                          │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  6. Save to PostgreSQL                                                 │     │
│  │     - Transaction for atomicity                                         │     │
│  │     - Update sync_log table                                             │     │
│  │     - Invalidate Redis cache                                            │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  7. Upload files to S3                                                 │     │
│  │     - Photos to photos bucket                                           │     │
│  │     - Signatures to photos bucket                                       │     │
│  │     - Generate CloudFront URLs                                          │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  8. Return sync response                                               │     │
│  │     - Synced record IDs                                                 │     │
│  │     - Server timestamps                                                 │     │
│  │     - Changes from other users                                          │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    ↓
                                    ↓ HTTPS Response
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────────┐
│  Mobile Device                                                                   │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  9. Update local database                                              │     │
│  │     - Mark records as synced                                            │     │
│  │     - Apply changes from server                                         │     │
│  │     - Update UI (reactive)                                              │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  10. Notify user                                                       │     │
│  │      - "Visit synced successfully"                                      │     │
│  │      - Show sync status icon                                            │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Communication Flow: Twilio Voice Alert

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│  Backend API                                                                     │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  1. Trigger voice alert                                                │     │
│  │     - Emergency situation detected                                      │     │
│  │     - Nurse requests backup                                             │     │
│  │     - Scheduled reminder                                                │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  2. Retrieve Twilio credentials                                        │     │
│  │     - AWS Secrets Manager                                               │     │
│  │     - Account SID, Auth Token                                           │     │
│  │     - Voice phone number                                                │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    ↓
                                    ↓ HTTPS POST to Twilio API
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────────┐
│  Twilio Voice API                                                                │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  3. Initiate voice call                                                │     │
│  │     - From: +1XXXXXXXXXX (Twilio number)                               │     │
│  │     - To: +1XXXXXXXXXX (recipient)                                     │     │
│  │     - Webhook: https://api-staging.berthcare.ca/v1/voice/webhook      │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    ↓
                                    ↓ Call connects
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────────┐
│  Recipient Phone                                                                 │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  4. Phone rings                                                        │     │
│  │     - Caller ID: BerthCare                                              │     │
│  │     - Recipient answers                                                 │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    ↓
                                    ↓ Twilio requests TwiML
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────────┐
│  Backend API                                                                     │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  5. Webhook receives call event                                        │     │
│  │     - Validate Twilio signature                                         │     │
│  │     - Validate auth token                                               │     │
│  │     - Log call event                                                    │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  6. Generate TwiML response                                            │     │
│  │     - <Say>: Text-to-speech message                                     │     │
│  │     - <Gather>: Collect keypress input                                  │     │
│  │     - <Record>: Record voice message                                    │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    ↓
                                    ↓ TwiML XML response
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────────┐
│  Twilio Voice API                                                                │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  7. Execute TwiML instructions                                         │     │
│  │     - Play message to recipient                                         │     │
│  │     - Collect input if needed                                           │     │
│  │     - Record response if needed                                         │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
│                                    ↓                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  8. Send status callback                                               │     │
│  │     - Call completed                                                    │     │
│  │     - Call duration                                                     │     │
│  │     - Recording URL (if applicable)                                     │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    ↓
                                    ↓ HTTPS POST to status callback
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────────┐
│  Backend API                                                                     │
│                                    │  │  9. Process call status                                            │     │
│  │     - Update database                                                   │     │
│  │     - Log call metrics                                                  │     │
│  │     - Notify relevant users                                             │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Monitoring & Observability Flow

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│  Application Layer                                                               │
│                                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐     │
│  │  Backend API                                                            │     │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │     │
│  │  │  Monitoring Middleware                                            │  │     │
│  │  │  - Request ID generation                                          │  │     │
│  │  │  - Request/response logging                                       │  │     │
│  │  │  - Performance timing                                             │  │     │
│  │  │  - Error capturing                                                │  │     │
│  │  └──────────────────────────────────────────────────────────────────┘  │     │
│  └────────────────────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────────────────────┘
                          ↓           ↓           ↓
              ┌───────────┴───────────┴───────────┴──────────┐
              ↓                       ↓                       ↓
┌───────────────────────┐ ┌───────────────────────┐ ┌───────────────────────┐
│  CloudWatch Metrics   │ │  Sentry               │ │  CloudWatch Logs      │
│                       │ │  Error Tracking       │ │                       │
│  - API latency        │ │                       │ │  - Structured JSON    │
│  - Error rate         │ │  - Exceptions         │ │  - Searchable         │
│  - Throughput         │ │  - Performance        │ │  - 30/90 day          │
│  - DB connections     │ │  - Breadcrumbs        │ │    retention          │
│  - Redis hits/misses  │ │  - User context       │ │                       │
└───────────────────────┘ └───────────────────────┘ └───────────────────────┘
              ↓                                                   ↓
┌───────────────────────┐                           ┌───────────────────────┐
│  CloudWatch           │                           │  CloudWatch           │
│  Dashboards           │                           │  Alarms               │
│                       │                           │                       │
│  - API Performance    │                           │  - Unhealthy hosts    │
│  - Database           │                           │  - Error rate high    │
│  - Error Tracking     │                           │  - DB CPU high        │
└───────────────────────┘                           │  - Latency high       │
                                                    └───────────────────────┘
                                                                ↓
                                                    ┌───────────────────────┐
                                                    │  SNS Topic            │
                                                    │  - Email alerts       │
                                                    │  - Escalation         │
                                                    └───────────────────────┘
```

---

**Document Version:** 2.0.0  
**Last Updated:** October 7, 2025  
**Maintained By:** DevOps Team
